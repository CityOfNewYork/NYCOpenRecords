{% if current_user.is_authenticated %}
{% if req.solid_status() == 'open' %}
<div class="row-fluid">
    <div class="span12">
        <ul class="nav nav-pills" role="tablist">
            <li>
                <a href="#acknowledge_request" role="tab" data-toggle="tab">
                    <small>Acknowledge Request</small>
                </a>
            </li>
            <li>
                <a href="#acknowledge_and_grant_request" role="tab" data-toggle="tab">
                    <small>Grant Request</small>
                </a>
            </li>
            <li>
                <a href="#acknowledge_and_deny_request" role="tab" data-toggle="tab">
                    <small>Deny Request</small>
                </a>
            </li>
        </ul>
    </div>
</div>
<div class="row-fluid">
    <div class="tab-content">
        <div class="tab-pane" id="acknowledge_request">
            <form name="note" id="AcknowledgeNote" method="post"
                  action="/update_a_request_acknowledge">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <h4>Estimated Duration</h4>
                    <select class="span12" id="acknowledge_status" name="acknowledge_status">
                        <option value="Acknowledged - 15 days">Acknowledged - 15 days</option>
                        <option value="Acknowledged - 30 days">Acknowledged - 30 days</option>
                        <option value="Acknowledged - 60 days">Acknowledged - 60 days</option>
                        <option value="Acknowledged - 90 days">Acknowledged - 90 days</option>
                        <option value="Acknowledged - 120 days">Acknowledged - 120 days</option>
                    </select>
                    <button id="rerouteButton" class="btn input-block-level" data-toggle="modal"
                            data-target="#confirm-submit" type="submit"><i class="icon-envelope"> </i>
                        Acknowledge Request
                    </button>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="acknowledge_and_grant_request">
            <form name="input_doc" style="margin-top: 2em;" id="submitRecord" method="post"
                  action="/add_a_record_and_close" autocomplete="on" enctype="multipart/form-data">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <div class="row-fluid">
                        <!-- name of record -->
                        <div class="control-group">
                            <label class="control-label" for="recordSummary">Name of record</label>

                            <div class="controls">
                                        <textarea class="input-xxlarge" name="record_description" type="text"
                                                  id="recordSummary"
                                                  placeholder="Add a short explanation of the record"
                                                  required/></textarea>
                            </div>
                        </div>
                        <!-- upload a record -->
                        <div class="control-group">
                            <label class="control-label">Upload a record <span id="recordTooltip" rel="tooltip"
                                                                               data-toggle="tooltip"
                                                                               data-placement="right" title=""
                                                                               data-original-title="{{'Upload a document'| explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                    <div class="fileinput fileinput-new" data-provides="fileinput">
                                                <span class="btn btn-default btn-file">
                                                    <span class="fileinput-new">Select file</span>
                                                    <span class="fileinput-exists">Change</span>
                                                    <input type="file" name="record">
                                                </span>
                                        <span class="fileinput-filename"></span>
                                        <a href="#" class="close fileinput-exists" data-dismiss="fileinput"
                                           style="float: none">&times;</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- link to a record -->
                        <div class="control-group">
                            <label class="control-label">Or provide a link to a record <span rel="tooltip"
                                                                                             data-toggle="tooltip"
                                                                                             data-placement="right"
                                                                                             title=""
                                                                                             data-original-title="{{'Add a link' |
                                        explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                    <input type="text" name="link_url" id="inputUrl" class="input-xxlarge"/>
                                    <!-- need to clean this up with jquery: needs to switch from being disabled when no file exists to being enabled when a file exists -->
                                </div>
                            </div>
                        </div>
                        <!-- offline record -->
                        <div class="control-group button-margin">
                            <label class="control-label">Or indicate how the record can be accessed offline <span
                                    id="offlinedocTooltip" rel="tooltip" data-toggle="tooltip" data-placement="right"
                                    title="" data-original-title="{{'Describe hard copies' | explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                            <textarea class="input-xxlarge" id="offlineDoc_textarea"
                                                      name="record_access"
                                                      placeholder="How can the requester get this record?  Ex. 'Sent via mail on a CD', 'Print out awaiting requester at City Clerk desk'"></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- submission -->
                        <div class="control-group">
                            <div class="controls">
                                <button type="submit" class="btn btn-default btn-block" data-toggle="modal"
                                        data-target="#confirm-submit" id="addRecordButton">Grant Request
                                </button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="acknowledge_and_deny_request">
            <form name="close" id="closeRequest" method="post" action="/close">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Reason <span rel="tooltip" data-toggle="tooltip"
                                                                      data-placement="right" title=""
                                                                      data-original-title="{{'Close a request'|
                                        explain_action }}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="controls">
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Not a public records request' |  explain_action('What')}}">Not
                                        a public records request
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Record Does Not Exist' | explain_action('What')}}">Do not have
                                        this record
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Personal Records' | explain_action('What')}}">Can
                                        Not Release - Personal Records
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Ongoing Litigation' | explain_action('What')}}">Can
                                        Not Release - Ongoing Litigation
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Investigative Records' | explain_action('What')}}">Can
                                        Not Release - Investigative Records
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Attorney-Client Privilege' | explain_action('What')}}">Can
                                        Not Release - Attorney-Client Privilege
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Contact Another Government Agency' | explain_action('What')}}">Contact
                                        Another Government Agency
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit NYC.gov' | explain_action('What')}}">Please visit
                                        NYC.gov
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit nycopendata' | explain_action('What')}}">Please
                                        visit NYC OpenData
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit NYC Government Publications Portal' | explain_action('What')}}">Please
                                        visit NYC Government Publications Portal
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <button id="closeButton" data-toggle="modal" data-target="#confirm-submit"
                                        type="submit"
                                        class="btn btn-default btn-block">Close this request
                                </button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
{% elif req.solid_status() == 'closed' %}
<div class="row-fluid">
    <div class="span12">
        <form name="reopen_request" id="question" method="post" action="/update_a_request_reopen">
            <input type="hidden" name="request_id" value="{{ req.id }}"/>
            <button id="reopenRequest" class="btn btn-default btn-block btn-block" type="submit">Reopen request</button>
        </form>
    </div>
</div>
{% else %}
<div class="row-fluid">
    <div class="span12">
        <ul class="nav nav-pills" role="tablist">
            <li><a href="#add_record" role="tab" data-toggle="tab">
                <small>Add Record</small>
            </a></li>
            <li><a href="#add_note" role="tab" data-toggle="tab">
                <small>Add Note</small>
            </a></li>
            <li><a href="#extend_request" role="tab" data-toggle="tab">
                <small>Extend Request</small>
            </a></li>
            <li><a href="#generate_pdf" role="tab" data-toggle="tab">
                <small>Generate Letter</small>
            </a></li>
            <li><a href="#close_request" role="tab" data-toggle="tab">
                <small>Close Request</small>
            </a></li>
            <li><a href="#manage_helpers" role="tab" data-toggle="tab">
                <small>Manage Helpers</small>
            </a></li>
            <li><a href="#change_assignee" role="tab" data-toggle="tab">
                <small>Change Assignee</small>
            </a></li>
        </ul>
    </div>
</div>
<div class="row-fluid">
    <div class="tab-content">
        <div class="tab-pane" id="add_record">
            <form name="input_doc" style="margin-top: 2em;" id="submitRecord" method="post"
                  action="/add_a_record_and_close" autocomplete="on" enctype="multipart/form-data">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <div class="row-fluid">
                        <!-- name of record -->
                        <div class="control-group">
                            <label class="control-label" for="recordSummary">Name of record</label>

                            <div class="controls">
                                        <textarea class="input-xxlarge" name="record_description" type="text"
                                                  id="recordSummary"
                                                  placeholder="Add a short explanation of the record"
                                                  required/></textarea>
                            </div>
                        </div>
                        <!-- upload a record -->
                        <div class="control-group">
                            <label class="control-label">Upload a record <span id="recordTooltip" rel="tooltip"
                                                                               data-toggle="tooltip"
                                                                               data-placement="right" title=""
                                                                               data-original-title="{{'Upload a document'| explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                    <div class="fileinput fileinput-new" data-provides="fileinput">
                                                <span class="btn btn-default btn-file">
                                                    <span class="fileinput-new">Select file</span>
                                                    <span class="fileinput-exists">Change</span>
                                                    <input type="file" name="record">
                                                </span>
                                        <span class="fileinput-filename"></span>
                                        <a href="#" class="close fileinput-exists" data-dismiss="fileinput"
                                           style="float: none">&times;</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- link to a record -->
                        <div class="control-group">
                            <label class="control-label">Or provide a link to a record <span rel="tooltip"
                                                                                             data-toggle="tooltip"
                                                                                             data-placement="right"
                                                                                             title=""
                                                                                             data-original-title="{{'Add a link' |
                                        explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                    <input type="text" name="link_url" id="inputUrl" class="input-xxlarge"/>
                                    <!-- need to clean this up with jquery: needs to switch from being disabled when no file exists to being enabled when a file exists -->
                                </div>
                            </div>
                        </div>
                        <!-- offline record -->
                        <div class="control-group button-margin">
                            <label class="control-label">Or indicate how the record can be accessed offline <span
                                    id="offlinedocTooltip" rel="tooltip" data-toggle="tooltip" data-placement="right"
                                    title="" data-original-title="{{'Describe hard copies' | explain_action}}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span></label>

                            <div class="row-fluid">
                                <div class="controls">
                                            <textarea class="input-xxlarge" id="offlineDoc_textarea"
                                                      name="record_access"
                                                      placeholder="How can the requester get this record?  Ex. 'Sent via mail on a CD', 'Print out awaiting requester at City Clerk desk'"></textarea>
                                </div>
                            </div>
                        </div>
                        <!-- submission -->
                        <div class="control-group">
                            <div class="controls">
                                <button type="submit" class="btn btn-default btn-block" data-toggle="modal"
                                        data-target="#confirm-submit" id="addRecordButton">Add a Record
                                </button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="add_note">
            <form name="note" id="note" method="post" action="/add_a_note">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Note <span rel="tooltip" data-toggle="tooltip"
                                                                    data-placement="right" title=""
                                                                    data-original-title="{{ 'Add a note' | explain_action }}">
                                <small><i class="icon-info-sign"></i></small>
                                </span></label>

                            <div class="controls">
                                <textarea type="text" class="input-xxlarge" id="noteTextarea" name="note_text"
                                          placeholder="Notes visible to staff only." required/></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <button type="submit" class="btn btn-default btn-block" data-toggle="modal"
                                        data-target="#confirm-submit" id="addNoteButton">Add note
                                </button>
                            </div>
                            <input type="hidden" name="note_privacy" value="2"/>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="extend_request">
            <form name="extend_request" id="extension" method="post" action="/add_a_extension">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <input type="hidden" name="extend_reason"
                       value="{{ 'Extension - Large Amount' | explain_action('What') }}"/>
                <fieldset>
                    <legend>Extend request</legend>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Length <span rel="tooltip" data-toggle="tooltip"
                                                                      data-placement="right" title=""
                                                                      data-original-title="{{ 'Request an extension'| explain_action }}">
                                <small><i class="icon-info-sign"></i></small>
                                </span></label>

                            <div class="controls">
                                <select id="days_after" name="days_after">
                                    <option value="0">None selected</option>
                                    <option value="15">15 days</option>
                                    <option value="30">30 days</option>
                                    <option value="60">60 days</option>
                                    <option value="90">90 days</option>
                                    <option value="-1">Custom Due Date</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group" style="display:none;" id="custom_due_date">
                            <label class="control-label">Custom Due Date<span rel="tooltip" data-toggle="tooltip"
                                                                              data-placement="right" title=""
                                                                              data-original-title="{{ 'Request an extension'| explain_action }}">
                                <small><i class="icon-info-sign"></i></small>
                                </span></label>

                            <div class="controls">
                                <input type="date" id="due_date"
                                       name="due_date"
                                       value="{{ min_due_date }}"
                                        >
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <button id="extendButton" data-toggle="modal" data-target="#confirm-submit"
                                        type="submit" class="btn btn-default btn-block">Extend this request
                                </button>

                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="generate_pdf">
            <form name="note" id="note_pdf" method="post" action="/add_a_pdf">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Template <span rel="tooltip" data-toggle="tooltip"
                                                                        data-placement="right" title=""
                                                                        data-original-title="{{'Generate PDF'}}">
                                <small><i class="icon-info-sign"></i></small>
                                </span></label>

                            <div class="controls">
                                <select id="response_template" name="response_template" required
                                        data-selected-text-format="count" size="9">
                                    <option value="template_02">Message Sent</option>
                                    <option value="template_03">Request Status</option>
                                    <option value="template_04">Request Completed</option>
                                    <option value="template_05">Request Status - Fulfilled in Part</option>
                                    <option value="template_06">Request Denied</option>
                                    <option value="template_07">Request Closed</option>
                                    <option value="template_08">Request Payment Information</option>
                                    <option value="template_09">Request Closed - No Response</option>
                                    <option value="template_10">Time Extension Requested</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <button type="submit" class="btn btn-default btn-block">Generate PDF</button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="close_request">
            <form name="close" id="closeRequest" method="post" action="/close">
                <input type="hidden" name="request_id" value="{{ req.id }}"/>
                <fieldset>
                    <legend>Close request</legend>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Reason <span rel="tooltip" data-toggle="tooltip"
                                                                      data-placement="right" title=""
                                                                      data-original-title="{{'Close a request'|
                                        explain_action }}">
                                        <small><i class="icon-info-sign"></i></small>
                                    </span>
                            </label>

                            <div class="controls">
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Fulfilled' | explain_action('What')}}">Fulfilled
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Fulfilled - Private Documents Not Uploaded' | explain_action('What')}}">Fulfilled
                                        - Private Documents Not Uploaded
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Fulfilled - Information Redacted' | explain_action('What')}}">Fulfilled
                                        - Information Redacted
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Fulfilled - Identity of Citizens Making Complaints Removed' | explain_action('What')}}">Fulfilled
                                        - Identity of Citizens Making Complaints
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Not a public records request' | explain_action('What')}}">Not a
                                        public records request
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Record Does Not Exist' | explain_action('What')}}">Do not have
                                        this record
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Personal Records' | explain_action('What')}}">Can
                                        Not Release - Personal Records
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Ongoing Litigation' | explain_action('What')}}">Can
                                        Not Release - Ongoing Litigation
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Investigative Records' | explain_action('What')}}">Can
                                        Not Release - Investigative Records
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Can Not Release - Attorney-Client Privilege' | explain_action('What')}}">Can
                                        Not Release - Attorney-Client Privilege
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Unable to contact the requester' | explain_action('What')}}">Unable
                                        to contact the requester
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Contact Another Government Agency' | explain_action('What')}}">Contact
                                        Another Government Agency
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Requester Not Interested' | explain_action('What')}}">Requester
                                        Not Interested
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Initial request redirected' | explain_action('What')}}">Initial
                                        request redirected
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit NYC.gov' | explain_action('What')}}">Please visit
                                        NYC.gov
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit nycopendata' | explain_action('What')}}">Please
                                        visit NYC OpenData
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label class="checkbox">
                                        <input type="checkbox" id="checkbox"
                                               value="{{'Please visit NYC Government Publications Portal' | explain_action('What')}}">Please
                                        visit NYC Government Publications
                                    </label>
                                </div>

                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">
                                <button id="closeButton" data-toggle="modal" data-target="#confirm-submit"
                                        type="submit"
                                        class="btn btn-default btn-block">Close request
                                </button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="tab-pane" id="manage_helpers">

            <form id="notifyForm" method="post" action="/add_a_owner">
                <fieldset>
                    <input type="hidden" name="request_id" value="{{ req.id }}"/>
                    <input id="notifyEmail" class="input-block-level" type="email" name="owner_email"
                           placeholder="name@email.com" data-provide="typeahead" autocomplete="off" required/>
                    <input id="notifyReason" class="input-block-level" type="text" name="owner_reason"
                           placeholder="Say why." required/>
                    <button id="notifyButton" class="btn btn-block btn-default" type="submit"><i
                            class="icon-envelope"> </i> Add a helper
                    </button>
            </form>
        </div>
        <div class="tab-pane" id="change_assignee">
            <form id="rerouteForm" method="post" action="/update_a_owner">
                <!-- my form -->
                <div class="control-group">
                    <div class="controls">
                        <input type="hidden" name="request_id" value="{{ req.id }}"/>
                        <!--input id="rerouteEmail" type="email" name="owner_email" placeholder="name@email.com" data-provide="typeahead" autocomplete="off" required /-->
                        <select class="span12" id="rerouteEmail" name="owner_email">
                            {% for user in users %}
                            <option value="{{ user.email }}">{{ user.alias }}</option>
                            {% endfor %}
                        </select>
                        <input id="rerouteReason" type="text" name="owner_reason" placeholder="Say why" required/>
                        <button id="rerouteButton" class="btn btn-default btn-block" type="submit"><i
                                class="icon-envelope"></i>&nbsp;Change Assignee
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endif %}